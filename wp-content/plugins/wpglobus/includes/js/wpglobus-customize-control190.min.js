jQuery(document).ready(function(e){"use strict";var t={languages:{},index:0,length:0,controlInstances:{},controlWidgets:{},instancesKeep:!1,widgetKeep:!1,action:!1,customizeSave:!1,selectorHtml:'<span style="margin-left:5px;" class="wpglobus-icon-globe"></span><span class="current-language" style="font-weight:bold;">{{language}}</span>',settingsSectionExpand:function(){e(document).triggerHandler("wpglobus_fields_settings_section_expand",[this,t])},init:function(o){t.setTitle(),"false"!=WPGlobusCustomizeOptions.themeEnabled&&(e.each(WPGlobusCoreData.enabled_languages,function(e,o){t.languages[e]=o,t.length=e}),t.addLanguageSelector(),t.setControlInstances(),t.setFieldsSection(),t.attachListeners(),t.setTinymce())},updateTinymce:function(e){"tinymce"==WPGlobusCustomize.controlInstances[this.id].type&&(WPGlobusCustomize.controlInstances[this.id].setting=WPGlobusCore.getString(WPGlobusCustomize.controlInstances[this.id].setting,e.target.textContent,WPGlobusCoreData.language))},setTinymce:function(o){e(document).on("tinymce-editor-init",function(o,n){"object"==typeof t.controlInstances[n.id]&&(t.controlInstances[n.id].type="tinymce",e(n.iframeElement).addClass("wpglobus-customize-control").css({width:"99%"}),n.on("input",_.debounce(t.updateTinymce,300)))})},getSize:function(e){return void 0===e?_.size(t.controlInstances):"widget"==e?_.size(t.controlWidgets):null},setFieldsSection:function(){var o={},n=e(".wpglobus-fields_settings_control_box").data("section-template"),s="",l="",i="";e.each(WPGlobusCustomize.controlInstances,function(e,t){void 0===o[t.section]&&(o[t.section]={}),o[t.section][e]=t}),e.each(o,function(t,o){if(l="<ul>",e.each(o,function(e,t){i=t.userControl.enabled?" checked ":"",l+='<li id="'+t.fieldSettings.itemID+'">',l+='<input id="'+t.fieldSettings.cbID+'" data-control="'+e+'" class="wpglobus-customize-cb-control" type="checkbox"'+i+' /> <span class="wpglobus-cb-control-title">'+t.title+"</span>",l+="</li>"}),l+="</ul>",void 0===wp.customize.section(t))return!0;s=(s=(s=(s=n.replace("{{section_title}}",wp.customize.section(t).params.title)).replace(/{{section}}/g,t)).replace("{{section_id}}",'"'+t+'"')).replace("{{items}}",l),e(s).insertBefore(e("#"+WPGlobusCustomizeOptions.userControlSaveButton))}),e("#accordion-section-wpglobus_fields_settings_section").css({"margin-top":"15px"}),e(WPGlobusCustomizeOptions.helpButton).insertAfter(e("#accordion-section-wpglobus_fields_settings_section .customize-action")),e("#accordion-section-wpglobus_fields_settings_section .customize-section-description").addClass("hidden"),e(document).on("click","."+WPGlobusCustomizeOptions.userControlIconClass,function(o){var n=e(this).data("section");e(WPGlobusCustomizeOptions.userControlBoxSelector).each(function(t,o){n==e(o).data("section")?e(this).css({display:"block"}):e(this).css({display:"none"})}),wp.customize.control("wpglobus_fields_settings_section").expand({completeCallback:t.settingsSectionExpand})}),e(".wpglobus-customize-icon-help.customize-help-toggle").on("click",function(t){e("#accordion-section-wpglobus_fields_settings_section .customize-section-description").toggleClass("hidden")})},setUserControls:function(t,o){var n=o.controlSelector+" "+o.selector,s='<img class="'+WPGlobusCustomizeOptions.userControlIconClass+'" data-section="'+o.section+'" style="position:absolute;right:0px;cursor:pointer;" src="'+WPGlobusCustomizeOptions.userControlIcon+'" />';e(s).insertBefore(n),o.userControl.enabled||(e(n).length>1?e(n).each(function(t,o){e(o).removeClass(WPGlobusCustomize.controlClass)}):e(n).removeClass(WPGlobusCustomize.controlClass).val(o.setting))},ctrlMenuItemsCallback:function(e,t){},ctrlWidgetCallback:function(o,n){if(t.action=!1,void 0===t.controlWidgets[o].element){void 0===n&&(n=wp.customize.control.instance(o)),t.controlWidgets[o].element={},t.controlWidgets[o].control=n,t.controlWidgets[o].inWidgetTitle=n.container.find(".in-widget-title"),t.controlWidgets[o].parent=n.selector;var s=n.container.find("input[type=submit]");0!=s.length&&(s.css({display:"block"}),s.attr("data-widget",o),t.controlWidgets[o].submit=s,t.attachWidgetListeners(t.controlWidgets[o])),n.liveUpdateMode=!1,void 0===n.setting().title?t.controlWidgets[o].inWidgetTitle.text(""):t.controlWidgets[o].inWidgetTitle.text(": "+WPGlobusCore.TextFilter(n.setting().title,WPGlobusCustomize.languageAdmin)),e.each(WPGlobusCustomize.elementSelector,function(s,l){var i=n.container.find(l);0!=i.length&&e.each(i,function(s,a){if(void 0===a.id||""==a.id)return!0;var c=e(i[s]);void 0===t.controlWidgets[o].element[a.id]&&(t.controlWidgets[o].element[a.id]={}),c.addClass("wpglobus-customize-widget-control"),c.attr("data-widget",o),t.controlWidgets[o].element[a.id].element=c,t.controlWidgets[o].element[a.id].setting=n.setting(),t.controlWidgets[o].element[a.id].selector=l,t.controlWidgets[o].element[a.id].value=a.defaultValue,c.val(WPGlobusCore.TextFilter(a.defaultValue,WPGlobusCoreData.language,"RETURN_EMPTY"))})}),e(document).triggerHandler("wpglobus_customize_control_added_widget",[o])}},ctrlCallback:function(o,n,s){var l=!1;if(e.each(WPGlobusCustomize.disabledSections,function(e,t){if(o.section()==t)return l=!0,!1}),!l&&(e.each(WPGlobusCustomize.disabledSettingMask,function(e,t){if(n.indexOf(t)>=0)return l=!0,!1}),!l)){var i=wp.customize.control.instance(n);if(n.indexOf("widget")>=0)return void 0===t.controlWidgets[n]&&(t.controlWidgets[n]={},t.action&&t.ctrlWidgetCallback(n,i)),t.controlWidgets[n].parent=i.selector,1!=e(i.selector).length?t.controlWidgets[n].observer=null:(t.controlWidgets[n].observer=new MutationObserver(function(e){e.forEach(function(e){"class"==e.attributeName&&-1!=e.target.className.indexOf("expanding")&&t.ctrlWidgetCallback(n)})}),t.controlWidgets[n].observer.observe(document.querySelector(t.controlWidgets[n].parent),{attributes:!0,childList:!0,characterData:!0})),!1;if(void 0===t.controlInstances[n]){var a=!0;e.each(WPGlobusCustomize.elementSelector,function(o,s){var l=i.container.find(s);if(0!=l.length){if("function"!=typeof i.setting)return!0;t.controlInstances[n]={},t.controlInstances[n].element=l,t.controlInstances[n].elementID=l.attr("id")?"#"+l.attr("id"):void 0,t.controlInstances[n].setting=i.setting(),t.controlInstances[n].selector=s,t.controlInstances[n].controlSelector=i.selector,t.controlInstances[n].type="",t.controlInstances[n].section=i.section(),t.controlInstances[n].title=null,t.controlInstances[n].userControl=null,t.controlInstances[n].fieldSettings={},t.controlInstances[n].fieldSettings.itemID="item-wpglobus-cb-control-"+WPGlobusDialogApp.convertToId(n),t.controlInstances[n].fieldSettings.cbID="wpglobus-cb-control-"+WPGlobusDialogApp.convertToId(n),e.each(WPGlobusCustomize.setLinkBy,function(o,s){if(n.indexOf(s)>=0){if(t.controlInstances[n].type="link",""==t.controlInstances[n].setting&&(t.controlInstances[n].setting=l[0].defaultValue),WPGlobusCustomize.changeset_uuid){var i=wp.customize.control(n).setting();if(-1!==i.indexOf("|||")){var a=t.getTranslations(i);wp.customize.control(n).setting(a[WPGlobusCoreData.default_language]),e(WPGlobusCustomize.controlInstances[n].controlSelector+" "+WPGlobusCustomize.controlInstances[n].selector).val(a[WPGlobusCoreData.default_language])}}l.addClass("wpglobus-control-link")}}),""===t.controlInstances[n].type&&(t.controlInstances[n].type="textarea"==s?"textarea":"text"),l.val(WPGlobusCore.TextFilter(t.controlInstances[n].setting,WPGlobusCoreData.language,"RETURN_EMPTY")),l.addClass("wpglobus-customize-control"),l.attr("data-wpglobus-customize-control",t.controlInstances[n].controlSelector.replace("#customize-control-","")),"link"==t.controlInstances[n].type&&(t.controlInstances[n].setting=t.convertString(l[0].defaultValue)),t.controlInstances[n].title=i.params.label,null!==WPGlobusCustomizeOptions.userControl&&void 0!==WPGlobusCustomizeOptions.userControl[WPGlobusCustomizeOptions.themeName]&&void 0!==WPGlobusCustomizeOptions.userControl[WPGlobusCustomizeOptions.themeName][n]&&"disable"==WPGlobusCustomizeOptions.userControl[WPGlobusCustomizeOptions.themeName][n]&&(a=!1),t.controlInstances[n].userControl={},t.controlInstances[n].userControl.enabled=a,t.setUserControls(n,t.controlInstances[n])}})}}},setControlInstances:function(){wp.customize.control.each(t.ctrlCallback)},setTitle:function(){e(WPGlobusCoreData.customize.info.element).html(WPGlobusCoreData.customize.info.html)},convertString:function(t){if(void 0===t)return t;var o=[],n=WPGlobusCore.getTranslations(t),s=0,l=!0;return t==n[WPGlobusCoreData.default_language]?t:(e.each(n,function(e,t){""==t?o[s]="null":(l=!1,o[s]=t),s++}),l?"":o.join("|||"))},getTranslations:function(t){if(void 0===t)return t;var o={},n=t.split("|||");return e.each(WPGlobusCoreData.enabled_languages,function(e,t){o[t]=void 0===n[e]||"null"===n[e]?"":n[e]}),o},getString:function(o,n,s){if(void 0===o)return o;void 0===n&&(n=""),void 0===s&&(s=WPGlobusCoreData.language);var l=t.getTranslations(o),i=[],a=0,c=!0;return e.each(l,function(e,t){e==s?(n=n.trim(),i[a]=""==n?"null":n):i[a]=""==t?"null":t,e!=WPGlobusCoreData.default_language&&"null"!=i[a]&&(c=!1),a++}),i=c?i[0]:i.join("|||")},addLanguageSelector:function(){"dropdown"!=WPGlobusCustomize.selectorType?(e(WPGlobusCustomize.selectorButton).insertAfter(".customize-controls-preview-toggle"),e(".wpglobus-customize-selector").html(t.selectorHtml.replace("{{language}}",WPGlobusCoreData.language)),e(document).on("click",".wpglobus-customize-selector",function(o){t.index>t.length-1?t.index=0:t.index++,WPGlobusCoreData.language=t.languages[t.index],e(this).html(t.selectorHtml.replace("{{language}}",WPGlobusCoreData.language)),e(document).triggerHandler("wpglobus_customize_control_language",[WPGlobusCoreData.language]),t.setControlsValue()})):t.addLanguageSelectorDropdown()},addLanguageSelectorDropdown:function(){e(WPGlobusCustomize.selectorButton).insertAfter(".customize-controls-preview-toggle"),e(".wpglobus-customize-selector").html(t.selectorHtml.replace("{{language}}",WPGlobusCoreData.language));var o=e(".wpglobus-customize-selector").offset(),n=o.top+46,s=0,l='<ul class="wpglobus-customize-selector-dropdown" style="display:none;position:fixed;width:46px;border-left:1px solid #ddd;border-right:1px solid #ddd;background-color:#eee;margin:-1px 0 0;padding:0;top:'+(n+="px;")+"left:"+(o.left+"px;")+'">';e.each(WPGlobusCoreData.enabled_languages,function(e,t){l+='<li class="item" style="text-align:center;cursor:pointer;border-bottom:1px solid #ddd;margin:0;" data-language="'+t+'">',l+='<span class="value value-'+t+'" style="font-size:15px;">'+t+"</span>",l+="</li>"}),l+='<li class="item wpglobus-customize-item-settings" style="text-align:center;cursor:pointer;border-bottom:1px solid #ddd;margin:0;"><span style="padding-top:14px;" class="dashicons dashicons-admin-tools"></span></li>',l+="</ul>",e(".wpglobus-customize-selector").after(l),e(document).on("mouseenter",".wpglobus-customize-selector",function(t){e(".wpglobus-customize-selector-dropdown").css({display:"block"}),s=t.screenY}),e(document).on("mouseleave",".wpglobus-customize-selector",function(t){0!=s&&t.screenY-s<=0&&e(".wpglobus-customize-selector-dropdown").css({display:"none"})}),e(document).on("mouseleave",".wpglobus-customize-selector-dropdown",function(t){e(".wpglobus-customize-selector-dropdown").css({display:"none"})}),e(document).on("mouseenter",".wpglobus-customize-selector-dropdown .item",function(t){var o=e(this),n=o.data("language");o.addClass("active"),o.css({"background-color":"#fff"}),o.find(".value-"+n).css({"font-weight":"bold"})}),e(document).on("mouseleave",".wpglobus-customize-selector-dropdown .item",function(t){var o=e(this);o.removeClass("active"),o.css({"background-color":"#eee"}),e(this).find(".value").css({"font-weight":""})}),e(document).on("click",".wpglobus-customize-selector-dropdown .item",function(o){var n=e(this).data("language");void 0!==n&&n!=e(".wpglobus-customize-selector").data("language")&&t.languageChanged(n)}),e(document).on("click",".wpglobus-customize-item-settings",function(o){wp.customize.control("wpglobus_fields_settings_section").expand({completeCallback:t.settingsSectionExpand}),e(".wpglobus-customize-selector-dropdown").css({display:"none"})})},languageChanged:function(o){WPGlobusCoreData.language=o,e(".wpglobus-customize-selector").data("language",o),e(".wpglobus-customize-selector .current-language").text(o),e(document).triggerHandler("wpglobus_customize_control_language",[WPGlobusCoreData.language]),t.setControlsValue()},setControlsValue:function(){e(".wpglobus-customize-control").each(function(o,n){var s=e(n),l=s.data("customize-setting-link");if(void 0!==WPGlobusCustomize.controlInstances[l]||(l=s.data("wpglobus-customize-control"),void 0!==WPGlobusCustomize.controlInstances[l]))if(s.hasClass("wpglobus-control-link")){var i=t.getTranslations(WPGlobusCustomize.controlInstances[l].setting);s.val(i[WPGlobusCoreData.language])}else{i=WPGlobusCore.TextFilter(WPGlobusCustomize.controlInstances[l].setting,WPGlobusCoreData.language,"RETURN_EMPTY");"tinymce"==WPGlobusCustomize.controlInstances[l].type&&tinymce.get(l).setContent(i,{format:"raw"}),s.val(WPGlobusCore.TextFilter(i,"RETURN_EMPTY"))}}),e(".wpglobus-customize-widget-control").each(function(t,o){var n=e(o),s=n.data("widget");if(void 0===n.attr("id"))return!0;n.val(WPGlobusCore.TextFilter(WPGlobusCustomize.controlWidgets[s].element[n.attr("id")].value,WPGlobusCoreData.language,"RETURN_EMPTY"))})},updateElements:function(o){void 0===o&&(o=!0),e.each(WPGlobusCustomize.controlInstances,function(e,n){if(!n.userControl.enabled)return!0;var s=wp.customize.control.instance(e);if("link"==n.type){var l=t.getTranslations(WPGlobusCustomize.controlInstances[e].setting);o?(s.setting.set(l[WPGlobusCoreData.language]),n.element.val(s.setting())):n.element.val(l[WPGlobusCoreData.language])}else if("tinymce"==n.type){l=WPGlobusCore.TextFilter(WPGlobusCustomize.controlInstances[e].setting,WPGlobusCoreData.language,"RETURN_EMPTY");tinymce.get(e).setContent(l,{format:"raw"}),n.element.val(l)}else o?(s.setting.set(WPGlobusCore.TextFilter(WPGlobusCustomize.controlInstances[e].setting,WPGlobusCoreData.language,"RETURN_EMPTY")),n.element.val(s.setting())):n.element.val(WPGlobusCore.TextFilter(WPGlobusCustomize.controlInstances[e].setting,WPGlobusCoreData.language,"RETURN_EMPTY"))})},onSubmitEvents:function(o){"mouseenter"==o.type?e.each(t.controlWidgets[e(this).data("widget")].element,function(t,o){e("#"+t).val(o.value)}):"mouseleave"==o.type?t.widgetKeep||e.each(t.controlWidgets[e(this).data("widget")].element,function(t,o){e("#"+t).val(WPGlobusCore.TextFilter(o.value,WPGlobusCoreData.language,"RETURN_EMPTY"))}):"click"==o.type&&(t.widgetKeep=!0)},attachWidgetListeners:function(o){void 0!==o.submit[0].id&&e(document).on("mouseenter","#"+o.submit[0].id,t.onSubmitEvents).on("mouseleave","#"+o.submit[0].id,t.onSubmitEvents).on("click","#"+o.submit[0].id,t.onSubmitEvents)},attachListeners:function(){e(".wpglobus-customize-control").on("keyup",function(o){var n=e(this),s=n.data("customize-setting-link");void 0===WPGlobusCustomize.controlInstances[s]&&(s=n.data("wpglobus-customize-control"),WPGlobusCustomize.controlInstances[s]),void 0===e(document).triggerHandler("wpglobus_customize_control_keyup",[n,s])&&("link"==WPGlobusCustomize.controlInstances[s].type?WPGlobusCustomize.controlInstances[s].setting=t.getString(WPGlobusCustomize.controlInstances[s].setting,n.val(),WPGlobusCoreData.language):WPGlobusCustomize.controlInstances[s].setting=WPGlobusCore.getString(WPGlobusCustomize.controlInstances[s].setting,n.val(),WPGlobusCoreData.language))}),e(document).on("keyup",".wpglobus-customize-widget-control",function(t){var o=e(this),n=o.data("widget");void 0!==WPGlobusCustomize.controlWidgets[n]&&(WPGlobusCustomize.controlWidgets[n].element[o.attr("id")].value=WPGlobusCore.getString(WPGlobusCustomize.controlWidgets[n].element[o.attr("id")].value,o.val(),WPGlobusCoreData.language))}),e(document).on("mouseenter","#save",function(t){e.each(WPGlobusCustomize.controlInstances,function(e,t){if(t.userControl.enabled){var o=wp.customize.control.instance(e);"tinymce"==t.type&&tinymce.get(e).setContent(t.setting,{format:"raw"}),o.setting.set(t.setting),t.element.val(o.setting())}})}).on("mouseleave","#save",function(e){t.instancesKeep||(t.updateElements(),wp.customize.previewer.refresh())}),e("#save").on("click",function(e){t.instancesKeep=!0}),e(document).on("ajaxSend",function(e,o,n){void 0!==n.data&&-1!=n.data.indexOf("wp_customize=on")&&-1!=n.data.indexOf("action=customize_save")&&(t.customizeSave=!0)}),e(document).on("ajaxComplete",function(o,n){void 0!==n.responseText&&(t.customizeSave?(t.updateElements(!1),t.instancesKeep&&(t.instancesKeep=!1)):(n.responseText.indexOf("WP_CUSTOMIZER_SIGNATURE")>=0&&(t.action="customizerAjaxComplete",t.setControlInstances()),e.each(WPGlobusCustomize.controlWidgets,function(o,s){var l=o.replace("_","-");if(n.responseText.indexOf(l)>=0)return s.submit.css({display:"block"}),s.control.liveUpdateMode=!1,e.each(s.element,function(t,o){e("#"+t).val(WPGlobusCore.TextFilter(o.value,WPGlobusCoreData.language,"RETURN_EMPTY"))}),s.inWidgetTitle.text(": "+WPGlobusCore.TextFilter(s.control.setting().title,WPGlobusCustomize.languageAdmin)),t.widgetKeep=!1,!1})),t.customizeSave=!1,wp.customize.previewer.refresh())})}};WPGlobusCustomize=e.extend({},WPGlobusCustomize,t),WPGlobusCustomize.init()});