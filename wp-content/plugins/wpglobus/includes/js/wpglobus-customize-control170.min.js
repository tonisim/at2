jQuery(document).ready(function(t){"use strict";var e={languages:{},index:0,length:0,controlInstances:{},controlWidgets:{},instancesKeep:!1,widgetKeep:!1,action:!1,customizeSave:!1,selectorHtml:'<span style="margin-left:5px;" class="wpglobus-icon-globe"></span><span style="font-weight:bold;">{{language}}</span>',settingsSectionExpand:function(){t(document).triggerHandler("wpglobus_fields_settings_section_expand",[this,e])},init:function(o){e.setTitle(),"false"!=WPGlobusCustomizeOptions.themeEnabled&&(t.each(WPGlobusCoreData.enabled_languages,function(t,o){e.languages[t]=o,e.length=t}),e.addLanguageSelector(),e.setControlInstances(),e.setFieldsSection(),e.attachListeners(),e.setTinymce())},updateTinymce:function(t){"tinymce"==WPGlobusCustomize.controlInstances[this.id].type&&(WPGlobusCustomize.controlInstances[this.id].setting=WPGlobusCore.getString(WPGlobusCustomize.controlInstances[this.id].setting,t.target.textContent,WPGlobusCoreData.language))},setTinymce:function(o){t(document).on("tinymce-editor-init",function(o,n){"object"==typeof e.controlInstances[n.id]&&(e.controlInstances[n.id].type="tinymce",t(n.iframeElement).addClass("wpglobus-customize-control").css({width:"99%"}),n.on("input",_.debounce(e.updateTinymce,300)))})},getSize:function(t){return void 0===t?_.size(e.controlInstances):"widget"==t?_.size(e.controlWidgets):null},setFieldsSection:function(){var o={},n=t(".wpglobus-fields_settings_control_box").data("section-template"),s="",i="",l="";t.each(WPGlobusCustomize.controlInstances,function(t,e){void 0===o[e.section]&&(o[e.section]={}),o[e.section][t]=e}),t.each(o,function(e,o){if(i="<ul>",t.each(o,function(t,e){l=e.userControl.enabled?" checked ":"",i+='<li id="'+e.fieldSettings.itemID+'">',i+='<input id="'+e.fieldSettings.cbID+'" data-control="'+t+'" class="wpglobus-customize-cb-control" type="checkbox"'+l+' /> <span class="wpglobus-cb-control-title">'+e.title+"</span>",i+="</li>"}),i+="</ul>",void 0===wp.customize.section(e))return!0;s=(s=(s=(s=n.replace("{{section_title}}",wp.customize.section(e).params.title)).replace(/{{section}}/g,e)).replace("{{section_id}}",'"'+e+'"')).replace("{{items}}",i),t(s).insertBefore(t("#"+WPGlobusCustomizeOptions.userControlSaveButton))}),t("#accordion-section-wpglobus_fields_settings_section").css({"margin-top":"15px"}),t(WPGlobusCustomizeOptions.helpButton).insertAfter(t("#accordion-section-wpglobus_fields_settings_section .customize-action")),t("#accordion-section-wpglobus_fields_settings_section .customize-section-description").addClass("hidden"),t(document).on("click","."+WPGlobusCustomizeOptions.userControlIconClass,function(o){var n=t(this).data("section");t(WPGlobusCustomizeOptions.userControlBoxSelector).each(function(e,o){n==t(o).data("section")?t(this).css({display:"block"}):t(this).css({display:"none"})}),wp.customize.control("wpglobus_fields_settings_section").expand({completeCallback:e.settingsSectionExpand})}),t(".wpglobus-customize-icon-help.customize-help-toggle").on("click",function(e){t("#accordion-section-wpglobus_fields_settings_section .customize-section-description").toggleClass("hidden")})},setUserControls:function(e,o){var n=o.controlSelector+" "+o.selector,s='<img class="'+WPGlobusCustomizeOptions.userControlIconClass+'" data-section="'+o.section+'" style="position:absolute;right:0px;cursor:pointer;" src="'+WPGlobusCustomizeOptions.userControlIcon+'" />';t(s).insertBefore(n),o.userControl.enabled||(t(n).length>1?t(n).each(function(e,o){t(o).removeClass(WPGlobusCustomize.controlClass)}):t(n).removeClass(WPGlobusCustomize.controlClass).val(o.setting))},ctrlMenuItemsCallback:function(t,e){},ctrlWidgetCallback:function(o,n){if(e.action=!1,void 0===e.controlWidgets[o].element){void 0===n&&(n=wp.customize.control.instance(o)),e.controlWidgets[o].element={},e.controlWidgets[o].control=n,e.controlWidgets[o].inWidgetTitle=n.container.find(".in-widget-title"),e.controlWidgets[o].parent=n.selector;var s=n.container.find("input[type=submit]");0!=s.length&&(s.css({display:"block"}),s.attr("data-widget",o),e.controlWidgets[o].submit=s,e.attachWidgetListeners(e.controlWidgets[o])),n.liveUpdateMode=!1,void 0===n.setting().title?e.controlWidgets[o].inWidgetTitle.text(""):e.controlWidgets[o].inWidgetTitle.text(": "+WPGlobusCore.TextFilter(n.setting().title,WPGlobusCustomize.languageAdmin)),t.each(WPGlobusCustomize.elementSelector,function(s,i){var l=n.container.find(i);0!=l.length&&t.each(l,function(s,a){if(void 0===a.id||""==a.id)return!0;var c=t(l[s]);void 0===e.controlWidgets[o].element[a.id]&&(e.controlWidgets[o].element[a.id]={}),c.addClass("wpglobus-customize-widget-control"),c.attr("data-widget",o),e.controlWidgets[o].element[a.id].element=c,e.controlWidgets[o].element[a.id].setting=n.setting(),e.controlWidgets[o].element[a.id].selector=i,e.controlWidgets[o].element[a.id].value=a.defaultValue,c.val(WPGlobusCore.TextFilter(a.defaultValue,WPGlobusCoreData.language,"RETURN_EMPTY"))})}),t(document).triggerHandler("wpglobus_customize_control_added_widget",[o])}},ctrlCallback:function(o,n,s){var i=!1;if(t.each(WPGlobusCustomize.disabledSections,function(t,e){if(o.section()==e)return i=!0,!1}),!i&&(t.each(WPGlobusCustomize.disabledSettingMask,function(t,e){if(n.indexOf(e)>=0)return i=!0,!1}),!i)){var l=wp.customize.control.instance(n);if(n.indexOf("widget")>=0)return void 0===e.controlWidgets[n]&&(e.controlWidgets[n]={},e.action&&e.ctrlWidgetCallback(n,l)),e.controlWidgets[n].parent=l.selector,1!=t(l.selector).length?e.controlWidgets[n].observer=null:(e.controlWidgets[n].observer=new MutationObserver(function(t){t.forEach(function(t){"class"==t.attributeName&&-1!=t.target.className.indexOf("expanding")&&e.ctrlWidgetCallback(n)})}),e.controlWidgets[n].observer.observe(document.querySelector(e.controlWidgets[n].parent),{attributes:!0,childList:!0,characterData:!0})),!1;if(void 0===e.controlInstances[n]){var a=!0;t.each(WPGlobusCustomize.elementSelector,function(o,s){var i=l.container.find(s);0!=i.length&&(e.controlInstances[n]={},e.controlInstances[n].element=i,e.controlInstances[n].elementID=i.attr("id")?"#"+i.attr("id"):void 0,e.controlInstances[n].setting=l.setting(),e.controlInstances[n].selector=s,e.controlInstances[n].controlSelector=l.selector,e.controlInstances[n].type="",e.controlInstances[n].section=l.section(),e.controlInstances[n].title=null,e.controlInstances[n].userControl=null,e.controlInstances[n].fieldSettings={},e.controlInstances[n].fieldSettings.itemID="item-wpglobus-cb-control-"+WPGlobusDialogApp.convertToId(n),e.controlInstances[n].fieldSettings.cbID="wpglobus-cb-control-"+WPGlobusDialogApp.convertToId(n),t.each(WPGlobusCustomize.setLinkBy,function(o,s){if(n.indexOf(s)>=0){if(e.controlInstances[n].type="link",""==e.controlInstances[n].setting&&(e.controlInstances[n].setting=i[0].defaultValue),WPGlobusCustomize.changeset_uuid){var l=wp.customize.control(n).setting();if(-1!==l.indexOf("|||")){var a=e.getTranslations(l);wp.customize.control(n).setting(a[WPGlobusCoreData.default_language]),t(WPGlobusCustomize.controlInstances[n].controlSelector+" "+WPGlobusCustomize.controlInstances[n].selector).val(a[WPGlobusCoreData.default_language])}}i.addClass("wpglobus-control-link")}}),""===e.controlInstances[n].type&&(e.controlInstances[n].type="textarea"==s?"textarea":"text"),i.val(WPGlobusCore.TextFilter(e.controlInstances[n].setting,WPGlobusCoreData.language,"RETURN_EMPTY")),i.addClass("wpglobus-customize-control"),i.attr("data-wpglobus-customize-control",e.controlInstances[n].controlSelector.replace("#customize-control-","")),"link"==e.controlInstances[n].type&&(e.controlInstances[n].setting=e.convertString(i[0].defaultValue)),e.controlInstances[n].title=l.params.label,null!==WPGlobusCustomizeOptions.userControl&&void 0!==WPGlobusCustomizeOptions.userControl[WPGlobusCustomizeOptions.themeName]&&void 0!==WPGlobusCustomizeOptions.userControl[WPGlobusCustomizeOptions.themeName][n]&&"disable"==WPGlobusCustomizeOptions.userControl[WPGlobusCustomizeOptions.themeName][n]&&(a=!1),e.controlInstances[n].userControl={},e.controlInstances[n].userControl.enabled=a,e.setUserControls(n,e.controlInstances[n]))})}}},setControlInstances:function(){wp.customize.control.each(e.ctrlCallback)},setTitle:function(){t(WPGlobusCoreData.customize.info.element).html(WPGlobusCoreData.customize.info.html)},convertString:function(e){if(void 0===e)return e;var o=[],n=WPGlobusCore.getTranslations(e),s=0,i=!0;return e==n[WPGlobusCoreData.default_language]?e:(t.each(n,function(t,e){""==e?o[s]="null":(i=!1,o[s]=e),s++}),i?"":o.join("|||"))},getTranslations:function(e){if(void 0===e)return e;var o={},n=e.split("|||");return t.each(WPGlobusCoreData.enabled_languages,function(t,e){o[e]=void 0===n[t]||"null"===n[t]?"":n[t]}),o},getString:function(o,n,s){if(void 0===o)return o;void 0===n&&(n=""),void 0===s&&(s=WPGlobusCoreData.language);var i=e.getTranslations(o),l=[],a=0,c=!0;return t.each(i,function(t,e){t==s?(n=n.trim(),l[a]=""==n?"null":n):l[a]=""==e?"null":e,t!=WPGlobusCoreData.default_language&&"null"!=l[a]&&(c=!1),a++}),l=c?l[0]:l.join("|||")},addLanguageSelector:function(){t(WPGlobusCustomize.selectorButton).insertAfter(".customize-controls-preview-toggle"),t(".wpglobus-customize-selector").html(e.selectorHtml.replace("{{language}}",WPGlobusCoreData.language)),t(document).on("click",".wpglobus-customize-selector",function(o){e.index>e.length-1?e.index=0:e.index++,WPGlobusCoreData.language=e.languages[e.index],t(this).html(e.selectorHtml.replace("{{language}}",WPGlobusCoreData.language)),t(document).triggerHandler("wpglobus_customize_control_language",[WPGlobusCoreData.language]),t(".wpglobus-customize-control").each(function(o,n){var s=t(n),i=s.data("customize-setting-link");if(void 0!==WPGlobusCustomize.controlInstances[i]||(i=s.data("wpglobus-customize-control"),void 0!==WPGlobusCustomize.controlInstances[i]))if(s.hasClass("wpglobus-control-link")){var l=e.getTranslations(WPGlobusCustomize.controlInstances[i].setting);s.val(l[WPGlobusCoreData.language])}else{l=WPGlobusCore.TextFilter(WPGlobusCustomize.controlInstances[i].setting,WPGlobusCoreData.language,"RETURN_EMPTY");"tinymce"==WPGlobusCustomize.controlInstances[i].type&&tinymce.get(i).setContent(l,{format:"raw"}),s.val(WPGlobusCore.TextFilter(l,"RETURN_EMPTY"))}}),t(".wpglobus-customize-widget-control").each(function(e,o){var n=t(o),s=n.data("widget");if(void 0===n.attr("id"))return!0;n.val(WPGlobusCore.TextFilter(WPGlobusCustomize.controlWidgets[s].element[n.attr("id")].value,WPGlobusCoreData.language,"RETURN_EMPTY"))})})},updateElements:function(o){void 0===o&&(o=!0),t.each(WPGlobusCustomize.controlInstances,function(t,n){if(!n.userControl.enabled)return!0;var s=wp.customize.control.instance(t);if("link"==n.type){var i=e.getTranslations(WPGlobusCustomize.controlInstances[t].setting);o?(s.setting.set(i[WPGlobusCoreData.language]),n.element.val(s.setting())):n.element.val(i[WPGlobusCoreData.language])}else if("tinymce"==n.type){i=WPGlobusCore.TextFilter(WPGlobusCustomize.controlInstances[t].setting,WPGlobusCoreData.language,"RETURN_EMPTY");tinymce.get(t).setContent(i,{format:"raw"}),n.element.val(i)}else o?(s.setting.set(WPGlobusCore.TextFilter(WPGlobusCustomize.controlInstances[t].setting,WPGlobusCoreData.language,"RETURN_EMPTY")),n.element.val(s.setting())):n.element.val(WPGlobusCore.TextFilter(WPGlobusCustomize.controlInstances[t].setting,WPGlobusCoreData.language,"RETURN_EMPTY"))})},onSubmitEvents:function(o){"mouseenter"==o.type?t.each(e.controlWidgets[t(this).data("widget")].element,function(e,o){t("#"+e).val(o.value)}):"mouseleave"==o.type?e.widgetKeep||t.each(e.controlWidgets[t(this).data("widget")].element,function(e,o){t("#"+e).val(WPGlobusCore.TextFilter(o.value,WPGlobusCoreData.language,"RETURN_EMPTY"))}):"click"==o.type&&(e.widgetKeep=!0)},attachWidgetListeners:function(o){void 0!==o.submit[0].id&&t(document).on("mouseenter","#"+o.submit[0].id,e.onSubmitEvents).on("mouseleave","#"+o.submit[0].id,e.onSubmitEvents).on("click","#"+o.submit[0].id,e.onSubmitEvents)},attachListeners:function(){t(".wpglobus-customize-control").on("keyup",function(o){var n=t(this),s=n.data("customize-setting-link");void 0===WPGlobusCustomize.controlInstances[s]&&(s=n.data("wpglobus-customize-control"),WPGlobusCustomize.controlInstances[s]),void 0===t(document).triggerHandler("wpglobus_customize_control_keyup",[n,s])&&("link"==WPGlobusCustomize.controlInstances[s].type?WPGlobusCustomize.controlInstances[s].setting=e.getString(WPGlobusCustomize.controlInstances[s].setting,n.val(),WPGlobusCoreData.language):WPGlobusCustomize.controlInstances[s].setting=WPGlobusCore.getString(WPGlobusCustomize.controlInstances[s].setting,n.val(),WPGlobusCoreData.language))}),t(document).on("keyup",".wpglobus-customize-widget-control",function(e){var o=t(this),n=o.data("widget");void 0!==WPGlobusCustomize.controlWidgets[n]&&(WPGlobusCustomize.controlWidgets[n].element[o.attr("id")].value=WPGlobusCore.getString(WPGlobusCustomize.controlWidgets[n].element[o.attr("id")].value,o.val(),WPGlobusCoreData.language))}),t(document).on("mouseenter","#save",function(e){t.each(WPGlobusCustomize.controlInstances,function(t,e){if(e.userControl.enabled){var o=wp.customize.control.instance(t);"tinymce"==e.type&&tinymce.get(t).setContent(e.setting,{format:"raw"}),o.setting.set(e.setting),e.element.val(o.setting())}})}).on("mouseleave","#save",function(t){e.instancesKeep||(e.updateElements(),wp.customize.previewer.refresh())}),t("#save").on("click",function(t){e.instancesKeep=!0}),t(document).on("ajaxSend",function(t,o,n){void 0!==n.data&&-1!=n.data.indexOf("wp_customize=on")&&-1!=n.data.indexOf("action=customize_save")&&(e.customizeSave=!0)}),t(document).on("ajaxComplete",function(o,n){void 0!==n.responseText&&(e.customizeSave?(e.updateElements(!1),e.instancesKeep&&(e.instancesKeep=!1)):(n.responseText.indexOf("WP_CUSTOMIZER_SIGNATURE")>=0&&(e.action="customizerAjaxComplete",e.setControlInstances()),t.each(WPGlobusCustomize.controlWidgets,function(o,s){var i=o.replace("_","-");if(n.responseText.indexOf(i)>=0)return s.submit.css({display:"block"}),s.control.liveUpdateMode=!1,t.each(s.element,function(e,o){t("#"+e).val(WPGlobusCore.TextFilter(o.value,WPGlobusCoreData.language,"RETURN_EMPTY"))}),s.inWidgetTitle.text(": "+WPGlobusCore.TextFilter(s.control.setting().title,WPGlobusCustomize.languageAdmin)),e.widgetKeep=!1,!1})),e.customizeSave=!1,wp.customize.previewer.refresh())})}};WPGlobusCustomize=t.extend({},WPGlobusCustomize,e),WPGlobusCustomize.init()});