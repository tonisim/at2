jQuery(document).ready(function(e){"use strict";var o={listID:"#wpglobus-sortable",customizeSave:!1,customizeSaveData:"",init:function(){e("#wpglobus-sortable").sortable({update:o.sortUpdate}),o.setJSCodeSection(),o.addListeners(),o.ajaxListener()},setJSCodeSection:function(){var o=WPGlobusCustomizeOptions.settings.wpglobus_js_editor_section;void 0!==o&&void 0!==o.wpglobus_customize_js_editor&&(e("#customize-control-wpglobus_customize_js_editor .customize-control-title").css({width:"50%"}).after('<span class="wpglobus-customize-js-editor-expand" style="float:right;"><a href="#">'+WPGlobusCustomizeOptions.i18n.expandShrink+"</a></span>"),e(document).on("click",".wpglobus-customize-js-editor-expand",function(o){var t=e(this),s=e("#customize-controls");t.toggleClass("expanded"),t.hasClass("expanded")?s.css({width:"500px"}):s.css({width:""})}),e("#sub-accordion-section-wpglobus_js_editor_section .customize-section-back").on("click",function(o){e("#customize-controls").css({width:""}),e(".wpglobus-customize-js-editor-expand").removeClass("expanded")}))},addListeners:function(){e("body").on("change",".wpglobus-listen-change",function(e){o.setState(!1)}),e("body").on("change","#wpglobus-sortable input.wpglobus-language-item",function(t){var s=e(this);s.prop("checked")||o.removeLanguage(s)}),e("#customize-control-wpglobus_add_languages_select_box select").on("change",function(e){o.addLanguage(e,this)}),e("#accordion-section-"+WPGlobusCustomizeOptions.sections.wpglobus_addons_section+" .accordion-section-title").off("click keydown"),e("body").on("click","#accordion-section-"+WPGlobusCustomizeOptions.sections.wpglobus_addons_section+" .accordion-section-title",function(e){window.open(WPGlobusCustomizeOptions.addonsPage,"_blank")}),e(document).on("click","#"+WPGlobusCustomizeOptions.userControlSaveButton,function(){o.userControlAjax(this)}),e(document).on("click","#accordion-section-"+WPGlobusCustomizeOptions.sections.wpglobus_js_editor_section+" .accordion-section-title",function(o){e("#customize-control-wpglobus_customize_js_editor .CodeMirror").css({height:"40em"})})},removeLanguage:function(o){var t=o.data("language"),s=e("#customize-control-wpglobus_add_languages_select_box select option").eq(0);e('<option value="'+t+'">'+WPGlobusCustomizeOptions.config.language_name[t]+" ("+WPGlobusCustomizeOptions.config.en_language_name[t]+") </option>").insertAfter(s),o.parent("li").remove()},addLanguage:function(t,s){var n=e(s).attr("value"),i=e("#wpglobus-item-skeleton").html(),a="",c=e(o.listID+" li").attr("class");if("select"!=n){a=(a=(a=(a=(a=(a=(a=(a=(a=i.replace("{{flag}}",'src="'+WPGlobusCustomizeOptions.config.flags_url+WPGlobusCustomizeOptions.config.flag[n]+'"')).replace("{{name}}",n)).replace("{{id}}",n)).replace('checked="{{checked}}"','checked="checked"')).replace('disabled="{{disabled}}"',"")).replace("{{item}}",WPGlobusCustomizeOptions.config.en_language_name[n]+" ("+n+") ")).replace("{{order}}","#")).replace("{{language}}",n)).replace("{{edit-link}}",WPGlobusCustomizeOptions.editLink.replace("{{language}}",n)),e('<li class="'+c+'">'+a+"</li>").appendTo(o.listID),o.setOrder();var u=e(s).find("option");e.each(u,function(o,t){e(t).attr("value")==n&&e(t).remove()})}},sortUpdate:function(e,t){o.setState(!1),o.setOrder()},setOrder:function(){e("#wpglobus-sortable input.wpglobus-language-item").each(function(o,t){var s=e(t);0==o?s.prop("disabled","disabled").prop("checked","checked"):s.removeProp("disabled"),s.data("order",o)})},setState:function(e){wp.customize.state("saved").set(e)},getCustomizeSaveData:function(){return o.customizeSaveData},enabledUserControl:function(e){return void 0!==WPGlobusCustomize.controlInstances[e]&&WPGlobusCustomize.controlInstances[e].userControl.enabled},userControlAjax:function(o){e(o).prop("disabled",!0);var t={};t.action="cb-controls-save",t.controls={},e(".wpglobus-customize-cb-control").each(function(o,s){var n=e(s);if(n.prop("checked"));else{var i=n.data("control");i=(i=i.replace("[","{{")).replace("]","}}"),t.controls[i]="disable"}}),e.ajax({beforeSend:function(){},type:"POST",url:WPGlobusCustomizeOptions.ajaxurl,data:{action:WPGlobusCustomizeOptions.process_ajax,order:t},dataType:"json"}).always(function(){location.reload(!0)})},ajax:function(t,s){if("wpglobus_customize_save"==t){var n={};n.action="wpglobus_customize_save",n.options={},e.each(WPGlobusCustomizeOptions.settings,function(t,s){e.each(s,function(t,s){if("wpglobus_customize_enabled_languages"==t)return n.options[s.option]={},e("#wpglobus-sortable input.wpglobus-language-item").each(function(o,t){n.options[s.option][e(this).data("language")]="1"}),!0;if(-1!=o.customizeSaveData.indexOf("wpglobus_customize_post_type_")&&-1!=t.indexOf("wpglobus_customize_post_type_"))void 0===n.options[s.option]&&(n.options[s.option]={}),n.options[s.option][t.replace("wpglobus_customize_post_type_","")]=e("#customize-control-"+t+" input").prop("checked")?1:0;else if(-1!=o.customizeSaveData.indexOf(t)){var i=e("#customize-control-"+t+" "+s.type),a="";if("textarea"==s.type)a=i.val();else if("wpglobus_checkbox"==s.type)i=e("#customize-control-"+t+" input"),a="wpglobus_customize_selector_wp_list_pages"==t?i.prop("checked")?1:0:i.prop("checked")?1:"";else if("checkbox"==s.type)a=i.prop("checked")?1:"";else if("select"==s.type)a=i.val();else if("code_editor"==s.type){var c=wp.customize.control.instance(t);void 0!==c&&(a=c.setting())}n.options[s.option]=a,"code_editor"==s.type&&void 0===c&&delete n.options[s.option]}})})}e.ajax({beforeSend:function(){},type:"POST",url:WPGlobusCustomizeOptions.ajaxurl,data:{action:WPGlobusCustomizeOptions.process_ajax,order:n},dataType:"json"})},getChangesetData:function(o){if(void 0!==o){var t=/customize_changeset_data=([^&]+)/.exec(o);if(void 0===t[1])return;var s,n=decodeURIComponent(t[1]),i=JSON.parse(n);e.each(i,function(e,o){void 0!==WPGlobusCustomize.controlInstances[e]&&(s="",s=(WPGlobusCustomize.controlInstances[e].type,WPGlobusCustomize.controlInstances[e].setting),i[e].value=s)});var a=JSON.stringify(i);a=(a=encodeURIComponent(a)).replace(/%20/g,"+"),o=o.replace(t[1],a)}return o},ajaxListener:function(){e(document).on("ajaxSend",function(e,t,s){void 0!==s.data&&-1!=s.data.indexOf("wp_customize=on")&&-1!=s.data.indexOf("action=customize_save")&&(-1!=s.data.indexOf("customized=")?(o.customizeSave=!0,o.customizeSaveData=s.data):-1!=s.data.indexOf("customize_changeset_data=")&&(s.data=o.getChangesetData(s.data)))}),e(document).on("ajaxComplete",function(e,t,s){void 0!==t.responseText&&o.customizeSave&&(o.customizeSave=!1,o.ajax("wpglobus_customize_save"))}),e(document).on("ajaxStop",function(){o.customizeSave&&(o.customizeSave=!1,o.ajax("wpglobus_customize_save"))})}};WPGlobusCustomizeOptions=e.extend({},WPGlobusCustomizeOptions,o),WPGlobusCustomizeOptions.init()});