!function(e){"use strict";if("undefined"!=typeof WPGlobusWidgets){var t={saveArbitraryTextOrHTML:!1,editor:{},languageBoxActive:!1,languageBoxTimeout:null,init:function(){t.addElements(),t.attachListeners(),t.arbitraryTextOrHTML()},wysiwygClean:function(){e(".wpglobus-dialog-field").each(function(t,i){var a=e(i).data("source-id");if(1==e("#"+a+"-tmce").size()){var o=e(i).next(".wpglobus_dialog_start");e(i).remove(),e(o).remove()}})},setupWidgetControl:function(i,a,o){var n=!1;if(e.each(t.editor,function(e,t){if(t.widgetName==i)return n=!0,!1}),!n){var r=a.$el[0].id;if(""==r){var d=a.$el[0].offsetParent;void 0===(r=e(d).attr("id"))&&e(".widget").each(function(t,a){var o=e(a).attr("id");if(-1!=o.indexOf(i))return r=o,!1})}var l="#"+r+" #widget-"+i+"-text",u="#"+r+" #widget-"+i+"-title";t.editor[o.id]={},t.editor[o.id].widgetName=i,t.editor[o.id].controls=a,t.editor[o.id].sourceTitleSelector=u,t.editor[o.id].titleSelector=null,t.editor[o.id].sourceSelector=l,t.editor[o.id].content=e(l).val(),t.editor[o.id].saveSelector="#"+r+" #widget-"+i+"-savewidget",t.editor[o.id].languageSelector="#"+r+" .wpglobus-current-language",t.editor[o.id].inWidgetTitleSelector="#"+r+" .in-widget-title";var s=WPGlobusCore.TextFilter(t.editor[o.id].content,WPGlobusCoreData.default_language,"RETURN_EMPTY");e("#"+o.id).val(s);var g="",c="";e.each(WPGlobusCoreData.enabled_languages,function(e,t){g=(g=(g=(g=(g=(g=(g='<a href="#" onclick="return false;" class="item" data-widget-id="{{widgetID}}" data-source="{{source}}" data-editor-id="{{editorID}}" data-language="{{language}}" data-widget-name="{{widgetName}}" style="text-align:center;"><span>{{item}}</span></a>').replace("{{language}}",t)).replace("{{item}}",WPGlobusCoreData.en_language_name[t])).replace("{{widgetName}}",i)).replace("{{widgetID}}",r)).replace("{{editorID}}",o.id)).replace("{{source}}",l),c+=g});var f='<button style="z-index:200000;" type="button" id="'+o.id+'-wpglobus-button" data-widget-id="'+r+'"class="wp-switch-editor switch-wpglobus-language wpglobus-icon-globe"><span class="wpglobus-current-language" data-language="en" style="">En</span></button><div class="wpglobus-language-box" style="position:absolute;top:0;left:0;display:none;z-index:200100;border:1px solid #9e9e9e;border-radius:3px;background-color:#fff;padding: 2px 5px;"><div style="display:flex;flex-direction:column;">'+c+"</div></div>";e("#"+r+" .wp-editor-tabs").append(f),WPGlobusDialogApp.addElement({id:a.fields.title[0].id,style:"width:93%;"})&&(t.editor[o.id].titleSelector="#"+a.fields.title[0].id),t.arbitraryWidgetTitle(o.id)}},arbitraryWidgetTitle:function(i){var a=WPGlobusCore.TextFilter(e("#"+t.editor[i].controls.fields.title[0].id).val(),WPGlobusCoreData.language);e(t.editor[i].inWidgetTitleSelector).text(": "+a)},setBoxTimeout:function(){t.languageBoxTimeout=setTimeout(function(){t.languageBoxActive=!1,e(".wpglobus-language-box").css({display:"none"})},1e3)},arbitraryTextOrHTML:function(){e(document).on("click",".switch-wpglobus-language",function(i){if(!t.languageBoxActive){t.languageBoxActive=!0;var a=e(this),o=a.data("widget-id"),n=a.position();n.top+=34,n.left+=10,e("#"+o+" .wpglobus-language-box").css({display:"block",top:n.top+"px",left:n.left+"px"}),t.setBoxTimeout()}}),e(document).on("mouseenter",".wpglobus-language-box",function(e){clearTimeout(t.languageBoxTimeout)}).on("mouseleave",".wpglobus-language-box",function(i){e(".wpglobus-language-box").css({display:"none"}),t.languageBoxActive=!1}),e(document).on("click",".wpglobus-language-box .item",function(i){var a=e(this),o=a.data("language"),n=a.data("widget-id"),r=a.data("editor-id");e("#"+n+" .wpglobus-current-language").text(o).data("language",o);var d=WPGlobusCore.TextFilter(t.editor[r].content,o,"RETURN_EMPTY");tinymce.get(r).setContent(d,{format:"raw"}),e("textarea#"+r).val(d)}),e(document).on("tinymce-editor-setup",function(i,a){e.each(wp.textWidgets.widgetControls,function(e,i){t.setupWidgetControl(e,i,a)})}),e(document).on("tinymce-editor-init",function(a,o){e(document).on("mouseenter",t.editor[o.id].saveSelector,function(i){e(t.editor[o.id].sourceTitleSelector).val(e(t.editor[o.id].titleSelector).val()),e(t.editor[o.id].sourceSelector).val(t.editor[o.id].content)}),e(document).on("click",t.editor[o.id].saveSelector,function(e){t.saveArbitraryTextOrHTML=o.id}),o.on("nodechange keyup",_.debounce(i,100)),e("#"+o.id).on("keyup",_.debounce(i,100))});function i(i){var a="";if(a="keyup"==i.type&&"tinymce"==i.target.id?e(i.target).data("id"):i.target.id,t.editor[a]){var o=e(t.editor[a].languageSelector).data("language"),n="";n=tinymce.get(a).isHidden()?e("#"+a).val():tinymce.get(a).getContent({format:"raw"}),t.editor[a].content=WPGlobusCore.getString(t.editor[a].content,n,o),e(t.editor[a].sourceSelector).val(t.editor[a].content)}}},addElements:function(i,a){var o,n=[];n[0]='input[type="text"]',n[1]="textarea",void 0===i||"class"==i?(o=".widget-liquid-right .widget .widget-content",e.each(n,function(e,i){t.makeClone(o,i)})):"id"==i&&(o="#"+a+" .widget-content",e.each(n,function(e,i){t.makeClone(o,i)}))},makeClone:function(t,i){e(t+" "+i).each(function(t,a){var o,n,r,d,l=e(a),u=!1;if(void 0===(d=l.attr("id"))||-1!=d.indexOf("-number")||""==d)return!0;if(_.each(WPGlobusWidgets.disabledMask,function(e){if(-1!=d.indexOf(e))return u=!0,!1}),u)return!0;if(o=e("#"+d).clone(),e(l).addClass("wpglobus-dialog-field-source hidden"),n=l.attr("name"),e(o).attr("id","wpglobus-"+d),e(o).attr("name","wpglobus-"+n),e(o).attr("data-source-id",d),e(o).attr("class","wpglobus-dialog-field"),e(o).attr("style","width:90%;"),r=WPGlobusCore.TextFilter(e(l).val(),WPGlobusCoreData.language),e(o).val(r),e('<div style="width:20px;" data-type="control" data-source-type="" data-source-id="'+d+'" class="wpglobus-widgets wpglobus_dialog_start wpglobus_dialog_icon"></div>').insertAfter(l),e(o).insertAfter(l),'input[type="text"]'==i&&""!=r){var s=l.parents(".widget").attr("id");e("#"+s+" .in-widget-title").text(": "+r)}})},attachListeners:function(){e(document).ajaxComplete(function(i,a,o){if(-1!=o.data.indexOf("action=save-widget"))if(-1!=o.data.indexOf("delete_widget=1"));else{if(t.saveArbitraryTextOrHTML){var n=WPGlobusCore.TextFilter(t.editor[t.saveArbitraryTextOrHTML].content,e(t.editor[t.saveArbitraryTextOrHTML].languageSelector).data("language"),"RETURN_EMPTY");return tinymce.get(t.saveArbitraryTextOrHTML).isHidden()?(e("#"+t.saveArbitraryTextOrHTML).val(n),e("#"+t.saveArbitraryTextOrHTML+"-tmce").click()):tinymce.get(t.saveArbitraryTextOrHTML).setContent(n,{format:"raw"}),t.arbitraryWidgetTitle(t.saveArbitraryTextOrHTML),void(t.saveArbitraryTextOrHTML=!1)}var r=o.data.split("widget-id=");r=r[1].split("&"),e(".widget-liquid-right .widget").each(function(i,a){var o=e(a).attr("id");-1!==o.indexOf(r[0])&&(t.addElements("id",o),t.wysiwygClean())})}}),e("body").on("change",".wpglobus-dialog-field",function(){var t,i=e(this),a="#"+i.data("source-id"),o="",n="";void 0!==a&&(o=e(a).val(),/(\{:|\[:|<!--:)[a-z]{2}/.test(o)?(e.each(WPGlobusCoreData.enabled_languages,function(e,a){""!=(t=a==WPGlobusCoreData.language?i.val():WPGlobusCore.TextFilter(o,a,"RETURN_EMPTY"))&&(n+=WPGlobusCore.addLocaleMarks(t,a))}),e(a).val(n)):e(a).val(i.val()))}),e(document).on("click",".widget-title, .widget-title-action",function(e){e.preventDefault(),t.wysiwygClean(),t.imageWidget(this)})},imageWidget:function(t){var i=e(t).parents(".widget").attr("id");if(-1!=i.indexOf("media_image")){var a=e("#"+i+" .in-widget-title"),o=e("#"+i).find('input[type="text"]').attr("id");if(-1!=o.indexOf(".")){var n="wpg-"+o.replace(".","_");if(e("#"+i).find('input[type="text"]').attr("name",n),WPGlobusDialogApp.addElement(n)){var r=e("#"+i).find('input[name="'+n+'"]'),d=WPGlobusCore.getTranslations(r.val())[WPGlobusCoreData.language];a.text(": "+d),setTimeout(function(){e("#wpglobus-"+n).val(d)},1e3)}}else if(WPGlobusDialogApp.addElement(o)){d=WPGlobusCore.getTranslations(e("#"+o).val())[WPGlobusCoreData.language];a.text(": "+d),setTimeout(function(){e("#wpglobus-"+o).val(d)},1e3)}}}};WPGlobusWidgets=e.extend({},WPGlobusWidgets,t)}}(jQuery);